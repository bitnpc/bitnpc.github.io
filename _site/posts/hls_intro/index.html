<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <!-- The Head -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="HLS 协议介绍" />
<meta property="og:locale" content="en" />
<meta name="description" content="HLS 协议 HLS 是 HTTP Live Streaming 的缩写，是由苹果公司提出的基于 HTTP 的流媒体网络传输协议，它可以同时支持直播和点播，还支持多清晰度、音视频双轨、字幕等功能。 它的原理是将一整条视频分成多段小的视频，完整的播放是由这一个个片段拼接而成的。 HLS 协议规定：" />
<meta property="og:description" content="HLS 协议 HLS 是 HTTP Live Streaming 的缩写，是由苹果公司提出的基于 HTTP 的流媒体网络传输协议，它可以同时支持直播和点播，还支持多清晰度、音视频双轨、字幕等功能。 它的原理是将一整条视频分成多段小的视频，完整的播放是由这一个个片段拼接而成的。 HLS 协议规定：" />
<link rel="canonical" href="https://bitnpc.github.io/posts/hls_intro/" />
<meta property="og:url" content="https://bitnpc.github.io/posts/hls_intro/" />
<meta property="og:site_name" content="Tony" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-05-27T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="HLS 协议介绍" />
<meta name="twitter:site" content="@bitnpc" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-11-27T00:38:20+08:00","datePublished":"2022-05-27T00:00:00+08:00","description":"HLS 协议 HLS 是 HTTP Live Streaming 的缩写，是由苹果公司提出的基于 HTTP 的流媒体网络传输协议，它可以同时支持直播和点播，还支持多清晰度、音视频双轨、字幕等功能。 它的原理是将一整条视频分成多段小的视频，完整的播放是由这一个个片段拼接而成的。 HLS 协议规定：","headline":"HLS 协议介绍","mainEntityOfPage":{"@type":"WebPage","@id":"https://bitnpc.github.io/posts/hls_intro/"},"url":"https://bitnpc.github.io/posts/hls_intro/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>HLS 协议介绍 | Tony
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Tony">
<meta name="application-name" content="Tony">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.2/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  
    <!-- Switch the mode between dark and light. -->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() {
      return 'mode';
    }
    static get MODE_ATTR() {
      return 'data-mode';
    }
    static get DARK_MODE() {
      return 'dark';
    }
    static get LIGHT_MODE() {
      return 'light';
    }
    static get ID() {
      return 'mode-toggle';
    }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener('change', () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }
          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();
      });
    } /* constructor() */

    get sysDarkPrefers() {
      return window.matchMedia('(prefers-color-scheme: dark)');
    }

    get isSysDarkPrefer() {
      return this.sysDarkPrefers.matches;
    }

    get isDarkMode() {
      return this.mode === ModeToggle.DARK_MODE;
    }

    get isLightMode() {
      return this.mode === ModeToggle.LIGHT_MODE;
    }

    get hasMode() {
      return this.mode != null;
    }

    get mode() {
      return sessionStorage.getItem(ModeToggle.MODE_KEY);
    }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      document.documentElement.removeAttribute(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage(
        {
          direction: ModeToggle.ID,
          message: this.modeStatus
        },
        '*'
      );
    }

    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }
        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }
      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.notify();
    } /* flipMode() */
  } /* ModeToggle */

  const modeToggle = new ModeToggle();
</script>

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle">
      
        
        <img src="/assets/img/avatar.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'">
      
    </a>

    <h1 class="site-title">
      <a href="/">Tony</a>
    </h1>
    <p class="site-subtitle fst-italic mb-0">不懂音乐的程序员不是好厨师</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/bitnpc"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/bitnpc"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['bitnpc','gmail.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                Home
              </a>
            </span>

          
        
          
        
          
            
              <span>HLS 协议介绍</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  <!-- CDN URL -->
  

  <!-- Add image path -->
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>HLS 协议介绍</h1>

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1653580800"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  May 27, 2022
</time>

      </span>

      <!-- lastmod date -->
      
        <span>
          Updated
          <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1701016700"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Nov 27, 2023
</time>

        </span>
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://twitter.com/bitnpc">Tony</a>
            
          </em>
        </span>

        <!-- read time -->
        <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="2279 words"
>
  <em>12 min</em> read</span>

      </div>
      <!-- .d-flex -->
    </div>
    <!-- .post-meta -->
  </header>

  <div class="content">
    <h2 id="hls-协议"><span class="me-2">HLS 协议</span><a href="#hls-协议" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p><code class="language-plaintext highlighter-rouge">HLS</code> 是 <code class="language-plaintext highlighter-rouge">HTTP Live Streaming </code>的缩写，是由苹果公司提出的基于 <code class="language-plaintext highlighter-rouge">HTTP</code> 的流媒体网络传输协议，它可以同时支持直播和点播，还支持多清晰度、音视频双轨、字幕等功能。 它的原理是将一整条视频分成多段小的视频，完整的播放是由这一个个片段拼接而成的。
<code class="language-plaintext highlighter-rouge">HLS</code> 协议规定：</p>

<ul>
  <li>视频的封装格式是 <code class="language-plaintext highlighter-rouge">TS</code>。</li>
  <li>视频的编码格式为 <code class="language-plaintext highlighter-rouge">H264</code>，音频编码格式为 <code class="language-plaintext highlighter-rouge">MP3</code>、<code class="language-plaintext highlighter-rouge">AAC</code>或者 <code class="language-plaintext highlighter-rouge">AC-3</code>。</li>
  <li>除了 <code class="language-plaintext highlighter-rouge">TS</code> 视频文件本身，还定义了用来控制播放的 <code class="language-plaintext highlighter-rouge">m3u8</code> 文件（文本文件）</li>
</ul>

<p><strong>优点:</strong></p>
<ol>
  <li>解决特殊情况下的防火墙屏蔽</li>
  <li>服务器拓展方便。<code class="language-plaintext highlighter-rouge">RTMP</code> 是一种有状态协议，很难对视频服务器进行平滑扩展，因为需要为每一个播放视频流的客户端维护状态。而 <code class="language-plaintext highlighter-rouge">HLS</code> 基于无状态协议（<code class="language-plaintext highlighter-rouge">HTTP</code>），客户端只是按照顺序使用下载存储在服务器的普通 <code class="language-plaintext highlighter-rouge">TS</code> 文件，做负责均衡如同普通的 <code class="language-plaintext highlighter-rouge">HTTP</code> 文件服务器的负载均衡一样简单</li>
  <li>码率自适应</li>
</ol>

<p><strong>缺点:</strong></p>
<ol>
  <li>直播场景的延迟高（录播无延迟影响）</li>
  <li>大量的 <code class="language-plaintext highlighter-rouge">TS</code> 片文件，会造成服务器存储和请求的压力</li>
</ol>

<h2 id="采集端流程"><span class="me-2">采集端流程</span><a href="#采集端流程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p><a href="/assets/img/post/post-2022-05-27/hls_live.png" class="popup img-link normal shimmer"><img src="/assets/img/post/post-2022-05-27/hls_live.png" alt="HLS" width="972" height="589"  loading="lazy"></a><em>HLS直播流程</em></p>

<ul>
  <li>AVInputs</li>
</ul>

<p>采集音视频源</p>

<ul>
  <li>Server</li>
</ul>

<p>服务器组件负责获取的媒体输入流 , 然后Media编码后 <code class="language-plaintext highlighter-rouge">MPEG-4</code>（<code class="language-plaintext highlighter-rouge">H.264</code> video 和 <code class="language-plaintext highlighter-rouge">AAC</code> audio）格式然后用硬件打包到 <code class="language-plaintext highlighter-rouge">MPEG-2</code> (MPEG-2 transport stream)的传输流中。图中显示,传输流会经过 <code class="language-plaintext highlighter-rouge">stream segmenter</code>, 这里的工作是 <code class="language-plaintext highlighter-rouge">MPEG-2</code> 传输流会被分散为小片段然后保存为一个或多个系列的 <code class="language-plaintext highlighter-rouge">.ts</code> 格式的媒体文件。这个过程需要借助编码工具来完成，比如 <code class="language-plaintext highlighter-rouge">Apple stream segmenter</code>。
视频是 <code class="language-plaintext highlighter-rouge">fmp4</code> 文件（新版）或 <code class="language-plaintext highlighter-rouge">ts</code> 文件（老版），纯音频会被编码为一些音频小片段，通常为 <code class="language-plaintext highlighter-rouge">ADTS</code> 头的 <code class="language-plaintext highlighter-rouge">AAC</code>、<code class="language-plaintext highlighter-rouge">MP3</code>、或者 <code class="language-plaintext highlighter-rouge">AC-3</code> 格式。</p>

<p>服务端可以采用硬件编码和软件编码两种形式，其功能都是按照上文描述的规则对现有的媒体文件进行切片并使用索引文件进行管理。而软件切片通常会使用 <code class="language-plaintext highlighter-rouge">Apple</code> 公司提供的工具或者第三方的集成工具。</p>

<ul>
  <li>Distribution</li>
</ul>

<p>提供 <code class="language-plaintext highlighter-rouge">HTTP</code> 服务，包含了 <code class="language-plaintext highlighter-rouge">Server</code> 创建好的 <code class="language-plaintext highlighter-rouge">m3u8</code> 索引和 <code class="language-plaintext highlighter-rouge">ts</code> 分片文件</p>

<ul>
  <li>Clients
请求 <code class="language-plaintext highlighter-rouge">m3u8</code> 资源</li>
</ul>

<h2 id="文件格式"><span class="me-2">文件格式</span><a href="#文件格式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p><code class="language-plaintext highlighter-rouge">HLS</code> 协议包含了两种类型的文件，索引文件和 <code class="language-plaintext highlighter-rouge">ts/fMP4</code> 文件</p>

<h3 id="索引文件"><span class="me-2">索引文件</span><a href="#索引文件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>有两种</p>
<ol>
  <li>Index file</li>
  <li>Alternate Index file</li>
</ol>

<p><a href="/assets/img/post/post-2022-05-27/hls_index.png" class="popup img-link w-50 normal shimmer"><img src="/assets/img/post/post-2022-05-27/hls_index.png" alt="HLS_Index" width="972" height="589"  loading="lazy"></a><em>HLS Index</em></p>

<h3 id="ts-文件"><span class="me-2">ts 文件</span><a href="#ts-文件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>每个 <code class="language-plaintext highlighter-rouge">ts</code> 文件都由若干个 <code class="language-plaintext highlighter-rouge">ts packet</code> 组成，每个 <code class="language-plaintext highlighter-rouge">ts packet</code> 包是 <code class="language-plaintext highlighter-rouge">188</code> 字节。
原因：为了适配 <code class="language-plaintext highlighter-rouge">ATM(Asynchronous Transfer Mode)</code> 系统</p>

<p>is motivated by the fact that the payload of the ATM Adaptation Layer-1 (AAL-1) cell is 47 bytes. Therefore, four AAL-1 cells can accommodate a single TS packet.</p>

<p><a href="/assets/img/post/post-2022-05-27/hls_ts.png" class="popup img-link normal shimmer"><img src="/assets/img/post/post-2022-05-27/hls_ts.png" alt="HLS_TS" width="972" height="589"  loading="lazy"></a><em>HLS TS</em></p>

<h3 id="fmp4"><span class="me-2">fMP4</span><a href="#fmp4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p><a href="/assets/img/post/post-2022-05-27/hls_fMP4.png" class="popup img-link normal shimmer"><img src="/assets/img/post/post-2022-05-27/hls_fMP4.png" alt="HLS_fMP4" width="972" height="589"  loading="lazy"></a><em>HLS fMP4</em>
在 <code class="language-plaintext highlighter-rouge">EXT-X-VERSION 7</code> 支持了<code class="language-plaintext highlighter-rouge">fMP4</code>.
<code class="language-plaintext highlighter-rouge">fMP4</code> 是基于 <code class="language-plaintext highlighter-rouge">MPEG-4 Part 12</code> 的流媒体格式，与 <code class="language-plaintext highlighter-rouge">mp4</code> 很相似，但也有一些区别，<code class="language-plaintext highlighter-rouge">fMP4</code> 更好的适应流式播的需求.
<code class="language-plaintext highlighter-rouge">fMP4</code> 可以支持 <code class="language-plaintext highlighter-rouge">h.265</code>，能够大大节省带宽，已经慢慢变成现在的视频主流，尤其是视频监控领域。</p>

<h2 id="播放模式"><span class="me-2">播放模式</span><a href="#播放模式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<ol>
  <li>
    <p>点播
当前时间点可以获取到所有 <code class="language-plaintext highlighter-rouge">index</code> 文件和 <code class="language-plaintext highlighter-rouge">ts</code> 文件，二级 <code class="language-plaintext highlighter-rouge">index</code> 文件中记录了所有 <code class="language-plaintext highlighter-rouge">ts</code> 文件的地址。这种模式允许客户端访问全部内容。上面的例子中就是一个点播模式下的 <code class="language-plaintext highlighter-rouge">m3u8</code> 的结构。</p>
  </li>
  <li>
    <p>直播
实时生成 <code class="language-plaintext highlighter-rouge">M3U8</code> 和 <code class="language-plaintext highlighter-rouge">ts</code> 文件。它的索引文件一直处于动态变化的，播放的时候需要不断下载二级 <code class="language-plaintext highlighter-rouge">index</code> 文件，以获得最新生成的 <code class="language-plaintext highlighter-rouge">ts</code> 文件播放视频。如果一个二级 <code class="language-plaintext highlighter-rouge">index</code> 文件的末尾没有 <code class="language-plaintext highlighter-rouge">#EXT-X-ENDLIST</code> 标志，说明它是一个 <code class="language-plaintext highlighter-rouge">Live</code> 视频流</p>
  </li>
</ol>

<h2 id="安全性"><span class="me-2">安全性</span><a href="#安全性" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>加密信息：#EXT-X-KEY:METHOD=AES-128,URI=”xx.key”,IV=xxx</p>

<p>FairPlay Streaming</p>

<p>FairPlay Streaming is:</p>
<ul>
  <li>A secure key delivery mechanism 
Content Key is protected on the network and on the client during playback</li>
  <li>Key delivery is transport agnostic 
Easy to integrate with existing key server infrastructure</li>
  <li>Requires protected HDMI for external output</li>
</ul>

<p>流程
<a href="/assets/img/post/post-2022-05-27/hls_fair_play.png" class="popup img-link normal shimmer"><img src="/assets/img/post/post-2022-05-27/hls_fair_play.png" alt="HLS_fair_play" width="972" height="589"  loading="lazy"></a><em>HLS Fair Play</em></p>

<h2 id="推流-demo"><span class="me-2">推流 Demo</span><a href="#推流-demo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>Conceptually, HTTP Live Streaming consists of three parts: the server component, the distribution component, and the client software.
In a typical configuration, a hardware encoder takes audio-video input, encodes it as HEVC video and AC-3 audio, and outputs a fragmented MPEG-4 file or an MPEG-2 transport stream. A software stream segmenter then breaks the stream into a series of short media files, which are placed on a web server. The segmenter also creates and maintains an index file containing a list of the media files. The URL of the index file is published on the web server. Client software reads the index, then requests the listed media files in order and displays them without any pauses or gaps between segments.</p>

<h3 id="下载工具"><span class="me-2">下载工具</span><a href="#下载工具" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>下载地址: https://developer.apple.com/download/all/?q=HLS</p>

<p>安装完发现有个 <code class="language-plaintext highlighter-rouge">go</code> 的 <code class="language-plaintext highlighter-rouge">example</code>
<a href="/assets/img/post/post-2022-05-27/hls_go_server.png" class="popup img-link normal shimmer"><img src="/assets/img/post/post-2022-05-27/hls_go_server.png" alt="HLS_go_server" width="972" height="589"  loading="lazy"></a><em>HLS Go Server</em>
<code class="language-plaintext highlighter-rouge">brew install go</code>，安装 <code class="language-plaintext highlighter-rouge">go</code>，然后启动该服务</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="c"># tony @ tonyMBP in ~/Desktop/hls_server [14:48:18]</span>
<span class="nv">$ </span>go run ll-hls-origin-example.go
ll-hls-origin-example.go:43:2: no required module provides package github.com/fsnotify/fsnotify: go.mod file not found <span class="k">in </span>current directory or any parent directory<span class="p">;</span> see <span class="s1">'go help modules'</span>


<span class="c"># tony @ tonyMBP in ~/Desktop/hls_server [14:48:25] C:1</span>
<span class="nv">$ </span>go mod init hls_server
go: creating new go.mod: module hls_server
go: to add module requirements and sums:
        go mod tidy
        
        
<span class="c"># tony @ tonyMBP in ~/Desktop/hls_server [14:49:23]</span>
<span class="nv">$ </span>go build
ll-hls-origin-example.go:43:2: no required module provides package github.com/fsnotify/fsnotify<span class="p">;</span> to add it:
        go get github.com/fsnotify/fsnotify
        
        
<span class="c"># tony @ tonyMBP in ~/Desktop/hls_server [14:49:28] C:1</span>
<span class="nv">$ </span>go get github.com/fsnotify/fsnotify
go: downloading github.com/fsnotify/fsnotify v1.5.4
go: downloading golang.org/x/sys v0.0.0-20220412211240-33da011f77ad
go: added github.com/fsnotify/fsnotify v1.5.4
go: added golang.org/x/sys v0.0.0-20220412211240-33da011f77ad


<span class="c"># tony @ tonyMBP in ~/Desktop/hls_server [14:49:48]</span>
<span class="nv">$ </span>go run ll-hls-origin-example.go
Listening on http://:8443/
</pre></td></tr></tbody></table></code></div></div>
<h3 id="启动-mediastreamsegmenter-服务"><span class="me-2">启动 mediastreamsegmenter 服务</span><a href="#启动-mediastreamsegmenter-服务" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>mediastreamsegmenter <span class="nt">-w</span> 499 <span class="nt">-t</span> 1 224.0.0.50:9121 <span class="nt">-s</span> 16 <span class="nt">-D</span> <span class="nt">-T</span> <span class="nt">-f</span> ~/Desktop/hls_server/hls
</pre></td></tr></tbody></table></code></div></div>

<h3 id="使用-ffmpeg-推流"><span class="me-2">使用 ffmpeg 推流</span><a href="#使用-ffmpeg-推流" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>既可以使用系统内置摄像头采集音视频，也可以指定本地视频文件。</p>

<h4 id="使用-mac-内置采集设备"><span class="me-2">使用 mac 内置采集设备</span><a href="#使用-mac-内置采集设备" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>ffmpeg <span class="nt">-f</span> avfoundation <span class="nt">-list_devices</span> <span class="nb">true</span> <span class="nt">-i</span> <span class="s2">""</span>

<span class="o">[</span>AVFoundation indev @ 0x7f924d904400] AVFoundation video devices:
<span class="o">[</span>AVFoundation indev @ 0x7f924d904400] <span class="o">[</span>0] FaceTime高清摄像头（内建）
<span class="o">[</span>AVFoundation indev @ 0x7f924d904400] <span class="o">[</span>1] Capture screen 0
<span class="o">[</span>AVFoundation indev @ 0x7f924d904400] AVFoundation audio devices:
<span class="o">[</span>AVFoundation indev @ 0x7f924d904400] <span class="o">[</span>0] LarkAudioDevice
<span class="o">[</span>AVFoundation indev @ 0x7f924d904400] <span class="o">[</span>1] 外置麦克风
<span class="o">[</span>AVFoundation indev @ 0x7f924d904400] <span class="o">[</span>2] MacBook Pro麦克风  


<span class="nv">$ </span>ffmpeg <span class="nt">-f</span> avfoundation <span class="nt">-framerate</span> 30 <span class="nt">-pixel_format</span> uyvy422 <span class="nt">-i</span> <span class="s2">"0:"</span> <span class="nt">-c</span>:v h264 <span class="nt">-fflags</span> nobuffer <span class="nt">-tune</span> zerolatency <span class="nt">-f</span> mpegts udp://192.168.1.5:9121
</pre></td></tr></tbody></table></code></div></div>

<h4 id="使用指定文件"><span class="me-2">使用指定文件</span><a href="#使用指定文件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>ffmpeg <span class="nt">-re</span> <span class="nt">-i</span> <span class="s2">"/Users/tony/Downloads/sample.mp4"</span> <span class="nt">-c</span>:v h264 <span class="nt">-fflags</span> nobuffer <span class="nt">-tune</span> zerolatency <span class="nt">-f</span> mpegts udp://192.168.1.5:9121
</pre></td></tr></tbody></table></code></div></div>

<h2 id="疑难问题"><span class="me-2">疑难问题</span><a href="#疑难问题" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<ol>
  <li><code class="language-plaintext highlighter-rouge">seek</code> 不准确如何解决？
<code class="language-plaintext highlighter-rouge">mp4</code> 可以 <code class="language-plaintext highlighter-rouge">seek</code> 到指定的时间戳， <code class="language-plaintext highlighter-rouge">ts</code> 是 <code class="language-plaintext highlighter-rouge">seek</code> 到文件的某个 <code class="language-plaintext highlighter-rouge">position</code>，而不能直接 <code class="language-plaintext highlighter-rouge">seek</code> 到指定的时间点。
在 <code class="language-plaintext highlighter-rouge">ffplay.c</code> 中的 <code class="language-plaintext highlighter-rouge">event_loop</code> 函数中包含了 <code class="language-plaintext highlighter-rouge">seek</code> 的相关代码。
对于 <code class="language-plaintext highlighter-rouge">ts</code>，具体 <code class="language-plaintext highlighter-rouge">seek</code> 操作调用函数关系为 <code class="language-plaintext highlighter-rouge">avformat_seek_file()=&gt; av_seek_frame() =&gt; seek_frame_internal() =&gt; seek_frame_byte()</code>
对于 <code class="language-plaintext highlighter-rouge">mp4</code>，具体 <code class="language-plaintext highlighter-rouge">seek</code> 操作调用函数关系为 <code class="language-plaintext highlighter-rouge">avformat_seek_file()=&gt; av_seek_frame() =&gt; seek_frame_internal() =&gt;mov_read_seek()</code></li>
</ol>

<p><code class="language-plaintext highlighter-rouge">ts seek</code> 逻辑是: 给定一个文件位置，直接将文件指针指向该位置。接下来调用 <code class="language-plaintext highlighter-rouge">read_packet()</code> 读取一个 <code class="language-plaintext highlighter-rouge">ts</code> 包(188字节)时，由于之前进行了 <code class="language-plaintext highlighter-rouge">seek</code> 操作，文件指针很可能没有指到一个 <code class="language-plaintext highlighter-rouge">ts packet</code> 的包头位置（包头以 <code class="language-plaintext highlighter-rouge">0x47 byte</code> 打头的），这时候需要调用 <code class="language-plaintext highlighter-rouge">mpegts_resync()</code> 进行重新同步找到包头，然后再重新读取一个完整 <code class="language-plaintext highlighter-rouge">ts packet</code>。
<code class="language-plaintext highlighter-rouge">mp4</code> 的 <code class="language-plaintext highlighter-rouge">seek</code> 操作逻辑是：给定一个 <code class="language-plaintext highlighter-rouge">seek</code> 的目标时间戳(timestamp)，根据 <code class="language-plaintext highlighter-rouge">mp4</code> 里每个包的索引信息，找到时间戳对应的包就可以了。根据下面的 <code class="language-plaintext highlighter-rouge">mp4</code> 的文件组织结构，利用<code class="language-plaintext highlighter-rouge">Sample Table</code>，可以快速找到任意给定时间戳的 <code class="language-plaintext highlighter-rouge">video audio</code> 数据包。</p>

<p>结论</p>
<ul>
  <li>对 <code class="language-plaintext highlighter-rouge">mp4</code> 文件来说，由于有索引表，可以快速找到某个时间戳所对应的数据，所以 <code class="language-plaintext highlighter-rouge">seek</code> 操作可以快速完成。</li>
  <li><code class="language-plaintext highlighter-rouge">ts</code> 文件没有时间戳和数据包位置的对应关系，所以对播放器来说，给定 <code class="language-plaintext highlighter-rouge">seek</code> 的时间戳 <code class="language-plaintext highlighter-rouge">ts_seek</code>，首先应该根据文件的码率估算一个位置 pos，然后获取该位置的数据包的时间戳 <code class="language-plaintext highlighter-rouge">ts_actual</code>，如果 <code class="language-plaintext highlighter-rouge">ts_actual</code> &lt; <code class="language-plaintext highlighter-rouge">ts_seek</code> ，则需要继续往后读取数据包；如果t s_actual&gt; ts_seek，则需要往前读取数据包，直到读到 <code class="language-plaintext highlighter-rouge">ts_seek</code> 对应的数据包。所以 <code class="language-plaintext highlighter-rouge">ts</code> 文件的操作可能更加耗时； 如果 <code class="language-plaintext highlighter-rouge">ts</code> 包含的是 <code class="language-plaintext highlighter-rouge">CBR</code> 码流，则 <code class="language-plaintext highlighter-rouge">ts_actual</code> 与 <code class="language-plaintext highlighter-rouge">ts_seek</code> 一般差别不大， <code class="language-plaintext highlighter-rouge">seek</code> 相对较快； 如果 <code class="language-plaintext highlighter-rouge">ts</code> 包含的 <code class="language-plaintext highlighter-rouge">VBR</code> 码流， 则 <code class="language-plaintext highlighter-rouge">ts_actual</code> 与 <code class="language-plaintext highlighter-rouge">ts_seek</code> 可能相差甚远， 则 <code class="language-plaintext highlighter-rouge">seek</code> 相对较慢。</li>
</ul>

<p><a href="/assets/img/post/post-2022-05-27/hls_seek.png" class="popup img-link w-50 normal shimmer"><img src="/assets/img/post/post-2022-05-27/hls_seek.png" alt="HLS_seek" width="972" height="589"  loading="lazy"></a><em>HLS Seek</em></p>

<ol>
  <li>不同分辨率的 <code class="language-plaintext highlighter-rouge">ts/fMP4</code> 文件的兼容性问题
安卓端在播放 <code class="language-plaintext highlighter-rouge">m3u8</code> 视频时，遇到了花屏问题。查明原因是 <code class="language-plaintext highlighter-rouge">ts</code> 分辨率改变
这个是必须加上 <code class="language-plaintext highlighter-rouge">hevc_mp4toannexb</code>，原始协议只支持 <code class="language-plaintext highlighter-rouge">h264_mp4toannexb</code>
<code class="language-plaintext highlighter-rouge">H.264/5</code> 码流分 <code class="language-plaintext highlighter-rouge">Annex-B</code> 和 <code class="language-plaintext highlighter-rouge">AVCC</code> 两种格式,
<code class="language-plaintext highlighter-rouge">AVCC</code> 以长度信息分割 <code class="language-plaintext highlighter-rouge">NALU</code>，在 <code class="language-plaintext highlighter-rouge">mp4</code> 和 <code class="language-plaintext highlighter-rouge">flv</code> 等封装格式中使用。
<code class="language-plaintext highlighter-rouge">Annex-B</code> 以 <code class="language-plaintext highlighter-rouge">start code(0x000001或0x00000001)</code> 分割 <code class="language-plaintext highlighter-rouge">NALU</code>，在 <code class="language-plaintext highlighter-rouge">mpegts</code> 流媒体文件中使用
加上 <code class="language-plaintext highlighter-rouge">hevc_mp4toannexb</code> 后每一帧都能解析出视频宽高，这样不会有切换花屏问题。</li>
</ol>

<p>参考资料</p>
<ol>
  <li>https://developer.apple.com/documentation/http_live_streaming/understanding_the_http_live_streaming_architecture</li>
  <li>https://en.wikipedia.org/wiki/MPEG_transport_stream</li>
  <li>http://anddymao.com/2021/08/03/2021-08-03-%E4%B8%80%E7%A7%8D%E4%B8%87%E8%83%BDhls%E5%8D%8F%E8%AE%AE%E8%A7%A3%E6%9E%90%E6%96%B9%E6%B3%95/</li>
</ol>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>,
          <a href="/categories/%E9%9F%B3%E8%A7%86%E9%A2%91/">音视频</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/hls/"
            class="post-tag no-text-decoration"
          >HLS</a>
        
          <a
            href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/"
            class="post-tag no-text-decoration"
          >音视频</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted me-1">Share</span>
  <span class="share-icons">
    
    
    

    
      
      <a
        href="https://twitter.com/intent/tweet?text=HLS%20%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D%20-%20Tony&url=https%3A%2F%2Fbitnpc.github.io%2Fposts%2Fhls_intro%2F"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Twitter"
        target="_blank"
        rel="noopener"
        aria-label="Twitter"
      >
        <i class="fa-fw fab fa-twitter"></i>
      </a>
    
      
      <a
        href="https://www.facebook.com/sharer/sharer.php?title=HLS%20%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D%20-%20Tony&u=https%3A%2F%2Fbitnpc.github.io%2Fposts%2Fhls_intro%2F"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Facebook"
        target="_blank"
        rel="noopener"
        aria-label="Facebook"
      >
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    
      
      <a
        href="https://t.me/share/url?url=https%3A%2F%2Fbitnpc.github.io%2Fposts%2Fhls_intro%2F&text=HLS%20%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D%20-%20Tony"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Telegram"
        target="_blank"
        rel="noopener"
        aria-label="Telegram"
      >
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get the last 5 posts from lastmod list. -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/ComfyUI_in_macOS/">在 macOS 上部署 ComfyUI</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/subset_generate/">子集生成</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/travel_hongkong/">香港之行</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/binary_search/">二分搜索及其应用</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/app_mach_o/">App 的本质和 Mach-O 文件</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/">音视频</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/leetcode/">leetcode</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ios/">iOS</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/macos/">macOS</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/p2p/">P2P</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/bfs/">BFS</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/crash/">Crash</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/deepseek/">Deepseek</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/dfs/">DFS</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="ps-0 pe-4">
    <h2 class="panel-heading ps-3 pt-2 mb-2">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->














  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/av_into/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1647187200"
  data-df="ll"
  
>
  Mar 14, 2022
</time>

              <h4 class="pt-0 my-2">音视频及其数字化表示</h4>
              <div class="text-muted">
                <p>
                  





                  声音和图像是两种不同的感知形式，它们的本质基于物理学的原理和感知机制。

声音和图像的本质
声音是由物体振动产生的机械波。当物体振动时，周围的空气分子也会振动，形成压缩和膨胀的波动。这种机械波通过空气传播，被耳朵中的鼓膜接收，然后通过听觉系统转化为我们能够感知的声音。

声音的特征由两个主要参数决定：频率和振幅。频率决定了声音的音调，而振幅则决定了声音的音量。

图像是通过光传递的信息。光是...
                </p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/ffmpeg_intro/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1653408000"
  data-df="ll"
  
>
  May 25, 2022
</time>

              <h4 class="pt-0 my-2">FFmpeg 简介</h4>
              <div class="text-muted">
                <p>
                  





                  FFmpeg 的定义
FFmpeg 既是一款音视频编解码工具，也是一组音视频编解码开发套件。
FFmpeg 支持多种协议，提供了多种多媒体格式的封装和解封装，音视频的编码、解码，采样率转换，码率转换，色彩格式转换等丰富的功能。
FF: fast forword
mpeg: Moving Picture Experts Group

音视频其他概念

  协议：如 HLS，rtsp
  封装格...
                </p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/low_latency_encoding/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1725552000"
  data-df="ll"
  
>
  Sep  6, 2024
</time>

              <h4 class="pt-0 my-2">使用 VideoToolbox 完成低延时视频编码</h4>
              <div class="text-muted">
                <p>
                  





                  Low Latency Pipeline

                </p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/ffmpeg_intro/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>FFmpeg 简介</p>
    </a>
  

  
    <a
      href="/posts/app_mach_o/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>App 的本质和 Mach-O 文件</p>
    </a>
  
</nav>

            
              
              <!--  The comments switcher -->

  
  <!-- https://giscus.app/ -->
<script type="text/javascript">
  (function () {
    const origin = 'https://giscus.app';
    const iframe = 'iframe.giscus-frame';
    const lightTheme = 'light';
    const darkTheme = 'dark_dimmed';

    let initTheme = lightTheme;
    const html = document.documentElement;

    if (
      (html.hasAttribute('data-mode') &&
        html.getAttribute('data-mode') === 'dark') ||
      (!html.hasAttribute('data-mode') &&
        window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      initTheme = darkTheme;
    }

    let giscusAttributes = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'bitnpc/bitnpc.github.io',
      'data-repo-id': 'R_kgDOJoJvzw',
      'data-category': 'General',
      'data-category-id': 'DIC_kwDOJoJvz84CWxsD',
      'data-mapping': 'pathname',
      'data-reactions-enabled': '1',
      'data-emit-metadata': '0',
      'data-theme': initTheme,
      'data-input-position': 'bottom',
      'data-lang': 'en',
      'data-loading': 'lazy',
      crossorigin: 'anonymous',
      async: ''
    };

    let giscusScript = document.createElement('script');
    Object.entries(giscusAttributes).forEach(([key, value]) =>
      giscusScript.setAttribute(key, value)
    );
    document.getElementById('tail-wrapper').appendChild(giscusScript);

    addEventListener('message', (event) => {
      if (
        event.source === window &&
        event.data &&
        event.data.direction === ModeToggle.ID
      ) {
        /* global theme mode changed */
        const mode = event.data.message;
        const theme = mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme;

        const message = {
          setConfig: {
            theme: theme
          }
        };

        const giscus = document.querySelector(iframe).contentWindow;
        giscus.postMessage({ giscus: message }, origin);
      }
    });
  })();
</script>



            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>
    ©
    <time>2025</time>
    <a href="https://twitter.com/bitnpc">Tony</a>.
    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/">音视频</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/leetcode/">leetcode</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ios/">iOS</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/macos/">macOS</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/p2p/">P2P</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/bfs/">BFS</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/crash/">Crash</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/deepseek/">Deepseek</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/dfs/">DFS</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.21.2/dist/tocbot.min.js"></script>






<script defer src="/assets/js/dist/post.min.js"></script>






    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

